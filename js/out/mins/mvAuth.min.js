app.factory("mvAuth",function(a,b,c,d){return{authenticateUser:function(e,f){var g=c.defer();return a.post("/login",{username:e,password:f}).then(function(a){if(a.data.success){var c=new d;angular.extend(c,a.data.user),b.currentuser=c,g.resolve(!0)}else g.resolve(!1)}),g.promise},createUser:function(a){var e=new d(a),f=c.defer();return e.$save().then(function(){console.log("newuser:"+JSON.stringify(e)),b.currentuser=e,f.resolve()},function(a){f.reject(a.data.reason)}),f.promise},logoutUser:function(){var d=c.defer();return a.post("/logout",{logout:!0}).then(function(){b.currentuser=void 0,d.resolve()}),d.promise},authorizeCurrentUserForRoute:function(a){return b.isAuthorized(a)?!0:c.reject("not authorized")}}});