app.factory("mvAuth",function(a,b,c,d){return{authenticateUser:function(e,f){var g=c.defer();return a.post("/login",{username:e,password:f}).then(function(a){if(a.data.success){var c=new d;angular.extend(c,a.data.user),b.currentuser=c,g.resolve(!0)}else g.resolve(!1)}),g.promise},createUser:function(a){var e=new d(a),f=c.defer();return e.$save().then(function(){console.log("newuser:"+JSON.stringify(e)),b.currentuser=e,f.resolve()},function(a){f.reject(a.data.reason)}),f.promise},logoutUser:function(){var d=c.defer();return a.post("/logout",{logout:!0}).then(function(){b.currentuser=void 0,d.resolve()}),d.promise},authorizeCurrentUserForRoute:function(a){return b.isAuthorized(a)?!0:c.reject("not authorized")}}}),app.factory("mvidentity",function(a,b){var c;if(window.bootstrappedUserObject){var c=new b;angular.extend(c,a.bootstrappedUserObject)}return{currentuser:c,isauthenticated:function(){return!!this.currentuser}}}),app.controller("mvNavBarLoginCtrl",function(a,b,c,d,e,f){a.identity=c,a.signin=function(a,b){e.authenticateUser(a,b).then(function(a){a?(d.notify("You have sucessfully logged in"),f("/partials/main/main")):d.notify("failed to login!")})},a.signout=function(){e.logoutUser().then(function(){a.username="",a.password="",d.notify("You have successfully logged out"),f.path("/")})}}),app.controller("mvSignupCtrl",function(a,b,c,d,e){a.signup=function(){var b={username:a.email,password:a.password,firstname:a.fname,lastname:a.lname};console.log("BHANU"),e.createUser(b).then(function(){c.Notify("User Account Created"),d.path("/")},function(a){c.error(a)})}}),app.factory("mvUser",function(a){var b=a("api/users/:id",{_id:"@id"},{query:{method:"GET",isArray:!0}});return b.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},b});